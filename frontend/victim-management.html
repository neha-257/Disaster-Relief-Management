<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Victim Management - Disaster Relief Management</title>
  <meta name="description" content="Victim Management System for Disaster Relief Management">
  <meta name="keywords" content="disaster, relief, victim, management">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="css/main.css" rel="stylesheet">
</head>

<body class="index-page">

  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.png" alt=""> -->
        <h1 class="sitename">Disaster Relief</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="victim-management.html" class="active">Victim Management</a></li>
          <li><a href="missing-persons.html">Missing Persons</a></li>
          <li><a href="relief-camps.html">Relief Camps</a></li>
          <li><a href="donations.html">Donations</a></li>
          <li><a href="inventory.html">Inventory</a></li>
          <li><a href="volunteers.html">Volunteers</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title dark-background">
      <div class="container position-relative">
        <h1>Victim Management</h1>
        <p>Add, update, and manage victim information during disaster relief operations</p>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li class="current">Victim Management</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Victim Management Section -->
    <section id="victim-management" class="section">

      <!-- Section Title -->
      <div class="container section-title" data-aos="fade-up">
        <h2>Victim Management</h2>
        <p>Register and manage victims affected by disasters</p>
      </div><!-- End Section Title -->

      <div class="container">
        <div class="row gy-4">

          <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
            <div class="service-item position-relative">
              <div class="icon">
                <i class="bi bi-person-plus"></i>
              </div>
              <h3>Register New Victim</h3>
              <p>Add details of newly rescued or identified victims.</p>
              <!-- Form for adding a new victim -->
              <form id="victim-form" class="mt-4">
                <div class="row gy-4">
                  <div class="col-md-6">
                    <input type="text" name="first_name" class="form-control" placeholder="First Name" required>
                  </div>
                  <div class="col-md-6">
                    <input type="text" name="last_name" class="form-control" placeholder="Last Name" required>
                  </div>
                  <div class="col-md-6">
                    <input type="date" name="date_of_birth" class="form-control" placeholder="Date of Birth">
                  </div>
                  <div class="col-md-6">
                    <input type="tel" name="contact_no" class="form-control" placeholder="Contact Number">
                  </div>
                  <div class="col-md-12">
                    <textarea name="address" class="form-control" rows="3" placeholder="Address"></textarea>
                  </div>
                  <div class="col-md-6">
                    <select name="camp_id" class="form-control" id="camp-select">
                      <option value="">Select Relief Camp</option>
                    </select>
                  </div>
                  <div class="col-md-12 text-center">
                    <button type="submit">Register Victim</button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200">
            <div class="service-item position-relative">
              <div class="icon">
                <i class="bi bi-people"></i>
              </div>
              <h3>Victim Records</h3>
              <p>View and manage all registered victims and their current status.</p>
              <!-- Victim Records Table -->
              <div class="table-responsive mt-4">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Contact</th>
                      <th>Camp</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="victims-table-body">
                    <!-- Victim records will be loaded here dynamically -->
                  </tbody>
                </table>
              </div>
              <div class="text-center mt-4">
                <a href="#" id="load-more-victims" class="btn btn-primary">View All Records</a>
              </div>
            </div>
          </div>

        </div>
      </div>

    </section><!-- End Victim Management Section -->

  </main>

  <footer id="footer" class="footer light-background">
    <div class="container">
      <h3 class="sitename">Disaster Relief Management</h3>
      <p>Providing efficient disaster relief operations and management of resources.</p>
      <div class="social-links d-flex justify-content-center">
        <a href="#"><i class="bi bi-twitter-x"></i></a>
        <a href="#"><i class="bi bi-facebook"></i></a>
        <a href="#"><i class="bi bi-instagram"></i></a>
        <a href="#"><i class="bi bi-linkedin"></i></a>
      </div>
      <div class="container">
        <div class="copyright">
          <span>Copyright</span> <strong class="px-1 sitename">Disaster Relief Management</strong> <span>All Rights Reserved</span>
        </div>
        <div class="credits">
          Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Main JS Files -->
  <script src="js/main.js"></script>
  <script src="js/api.js"></script>
  
  <!-- Page Specific JS -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Load relief camps for dropdown
      loadReliefCamps();
      
      // Load victims for table
      loadVictims();
      
      // Setup form submission
      const victimForm = document.getElementById('victim-form');
      victimForm.addEventListener('submit', handleVictimFormSubmit);
      
      // Setup view all button
      const loadMoreBtn = document.getElementById('load-more-victims');
      loadMoreBtn.addEventListener('click', function(e) {
        e.preventDefault();
        loadVictims(true); // Load all victims
      });
    });
    
    // Load relief camps for dropdown
    async function loadReliefCamps() {
      try {
        const response = await reliefCampAPI.getAll();
        const campSelect = document.getElementById('camp-select');
        
        // Clear any existing options except the first one
        while (campSelect.options.length > 1) {
          campSelect.remove(1);
        }
        
        // Add camps to dropdown
        if (response.success && response.data) {
          response.data.forEach(camp => {
            const option = document.createElement('option');
            option.value = camp.camp_id;
            option.textContent = camp.camp_name;
            campSelect.appendChild(option);
          });
        }
      } catch (error) {
        showAlert('Failed to load relief camps: ' + error.message, 'danger');
      }
    }
    
    // Load victims for table
    async function loadVictims(showAll = false) {
      try {
        const response = await victimAPI.getAll();
        const tableBody = document.getElementById('victims-table-body');
        
        // Clear existing rows
        tableBody.innerHTML = '';
        
        if (response.success && response.data) {
          // Limit to 5 if not showing all
          const victimsToShow = showAll ? response.data : response.data.slice(0, 5);
          
          victimsToShow.forEach(victim => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${victim.victim_id}</td>
              <td>${victim.first_name} ${victim.last_name}</td>
              <td>${victim.contact_no || 'N/A'}</td>
              <td>${victim.camp_name || 'Not Assigned'}</td>
              <td>
                <button class="btn btn-sm btn-primary edit-victim" data-id="${victim.victim_id}">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-sm btn-danger delete-victim" data-id="${victim.victim_id}">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            `;
            tableBody.appendChild(row);
          });
          
          // Add event listeners to edit and delete buttons
          document.querySelectorAll('.edit-victim').forEach(button => {
            button.addEventListener('click', function() {
              const victimId = this.getAttribute('data-id');
              // Implement edit functionality
              console.log('Edit victim with ID:', victimId);
              // This would typically open a modal or redirect to an edit page
            });
          });
          
          document.querySelectorAll('.delete-victim').forEach(button => {
            button.addEventListener('click', async function() {
              const victimId = this.getAttribute('data-id');
              if (confirm('Are you sure you want to delete this victim?')) {
                try {
                  const result = await victimAPI.delete(victimId);
                  if (result.success) {
                    showAlert('Victim deleted successfully');
                    loadVictims(showAll); // Reload the table
                  }
                } catch (error) {
                  showAlert('Failed to delete victim: ' + error.message, 'danger');
                }
              }
            });
          });
        }
      } catch (error) {
        showAlert('Failed to load victims: ' + error.message, 'danger');
      }
    }
    
    // Handle victim form submission
    async function handleVictimFormSubmit(e) {
      e.preventDefault();
      
      try {
        const formData = formToJSON(this);
        const response = await victimAPI.create(formData);
        
        if (response.success) {
          showAlert('Victim registered successfully');
          this.reset();
          loadVictims(); // Reload the table
        }
      } catch (error) {
        showAlert('Failed to register victim: ' + error.message, 'danger');
      }
    }
  </script>

</body>

</html> 